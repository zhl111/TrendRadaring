# 智能去重功能说明

## 功能概述

TrendRadaring 现在支持智能去重功能，可以自动识别和去除相似的新闻标题，避免在飞书等通知渠道中收到重复信息。

## 工作原理

### 1. 标题标准化
系统会对新闻标题进行标准化处理：
- 移除常见标点符号和特殊字符
- 移除数字和时间信息
- 移除常见的新闻前缀（如"突发"、"重磅"、"最新"等）
- 移除常见的新闻后缀（如"最新消息"、"详情"、"视频"等）

### 2. 相似度计算
使用最长公共子序列（LCS）算法计算标题间的相似度：
- 相似度范围：0.0 - 1.0
- 1.0 表示完全相同，0.0 表示完全不同

### 3. 智能去重
- 按新闻排名排序（排名越高越重要）
- 保留排名最高的新闻，移除相似的低排名新闻
- 支持自定义相似度阈值

## 配置选项

在 `config/config.yaml` 中添加了以下配置：

```yaml
# 智能去重配置
deduplication:
  enable_smart_dedup: true # 是否启用智能去重
  similarity_threshold: 0.8 # 相似度阈值，0.8表示80%相似就认为是重复
```

### 配置说明

- `enable_smart_dedup`: 
  - `true`: 启用智能去重（推荐）
  - `false`: 禁用智能去重，保持原有行为

- `similarity_threshold`: 
  - 范围：0.0 - 1.0
  - 推荐值：0.8（80%相似度）
  - 值越高，去重越严格
  - 值越低，去重越宽松

## 使用示例

### 去重前
```
1. 突发！某地发生重大事件
2. 【重磅】某地发生重大事件详情  
3. 某地发生重大事件最新消息
4. 苹果发布新iPhone 15
5. 股市大涨3%创新高
6. 股市暴涨3%再创新高
```

### 去重后（阈值=0.8）
```
1. 突发！某地发生重大事件 (保留排名最高的)
4. 苹果发布新iPhone 15
5. 股市大涨3%创新高
6. 股市暴涨3%再创新高
```

## 测试功能

运行测试脚本验证去重效果：

```bash
python test_dedup.py
```

## 注意事项

1. **性能影响**: 智能去重会增加少量计算开销，但对整体性能影响很小
2. **准确性**: 算法基于文本相似度，可能偶尔误判，可通过调整阈值优化
3. **语言支持**: 主要针对中文新闻优化，对其他语言也有一定效果
4. **保留策略**: 总是保留排名最高的新闻，确保重要信息不丢失

## 效果监控

- 启用去重后，飞书消息底部会显示去重状态
- 控制台会输出去重统计信息
- 可通过日志观察去重效果

## 建议设置

- **高频监控场景**: `similarity_threshold: 0.7` (更激进的去重)
- **一般使用场景**: `similarity_threshold: 0.8` (推荐设置)
- **保守使用场景**: `similarity_threshold: 0.9` (更保守的去重)

## 故障排除

如果遇到问题：
1. 检查配置文件语法是否正确
2. 确认相似度阈值设置合理（0.0-1.0）
3. 可临时设置 `enable_smart_dedup: false` 禁用功能
4. 查看控制台输出的去重日志信息